<!DOCTYPE html>
<html>
  <head>
    <!-- Theme specific CSS files are loaded later by the ThemeManager -->
    <link id="base_stylesheet" rel="stylesheet" type="text/css" href="css/base.css" />
    <script type="text/javascript" src="lib/3rdparty/jquery.js"></script>
    <script type="text/javascript" src="lib/3rdparty/classy.js"></script>
    <title>KanbaApp</title>
    <script>
      // main url
      // TODO move to some config file
      var KANBANERY_API_URL = 'smackaho.st:3000/api/v1';
      var WORKSPACE = 'sparrow';
      var Kanbanery = {};

      function kanbaneryApiUrl(url){
        return 'http://' + WORKSPACE + '.' + KANBANERY_API_URL + '/' + url;
      };

      function checkAuthentication(){
        
      };

      function projectId(){
        return $("#project_id").val(); 
      }
      
      Kanbanery.Project = Class.$extend({
        __init__: function(){
          this.list = [];
        },

        getList: function() {
          var that = this;
          var url = 'projects.json';        
          $.get(kanbaneryApiUrl(url), 
             function(data){
               console.log(data)
               alert("Data Loaded: " + data);
             }
          );
        },

        get: function(id){
          var url = ['projects/', id, '.json'].join('');
          var project = Kanbanery.Ajax.get(url);
          return project;
        }
      });
      Kanbanery.Type = Class.$extend({
        __init__: function(project){
          this.types = [];
          this.project = project;
        },

        getList: function(){
        var url = '';
        }
      
      })
     Kanbanery.Task =  Class.$extend({
        __init__: function() {
          this.form = $('#new_task');
        },

        add: function(){
         //POST https://WORKSPACE.kanbanery.com/api/v1/projects/PROJECT_ID/tasks.json
         this.form.submit(function(event){
           event.preventDefault();
           var url = 'projects/' + projectId() + '/tasks.json'
           var params = $(this).serialize();

           console.log(params)
           $.post(kanbaneryApiUrl(url), params, function(data){
             console.log(data);
           });

           return false;
         });
       }

      });

      $(function(){
        console.log('start');
        k = new Kanbanery.Task();
        k.add();

        console.log('end');
      })
    </script>

    <style></style>
  </head>
  <body>
    <div>
      <label>Project Id</label>
      <input name="project_id" id="project_id"></input>
      <form id="new_task" action="tasks.json">
        <select name="task_type_id">
          <option value="1">Bug</option>
        </select><br />
        <label for="title">Title</label>
        <input name="title" />
        
        <label for="description">Desription</label>
        <textarea name="description"></textarea>

        <input type="submit" value="Go" name="submit" />
      </form>
    </div>
  </body>
</html>
